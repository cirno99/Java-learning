---
order: 350
---

# Linux概念 - Load 平均负载

## 1. 简介

Linux load averages 是系统负载平均值（system load averages），它将正在运行的线程（任务）对系统的需求显示为平均运行数和等待线程数。Linux load averages 可以衡量任务对系统的需求，并且它可能大于系统当前正在处理的数量，大多数工具将其显示为三个平均值，分别为 1、5 和 15 分钟值。

### 1.1 查看命令

以下为系统中显示 Linux load averages 的实例：

```bash
# 方法一：uptime
$ uptime
 16:48:24 up  4:11,  1 user,  load average: 25.25, 23.40, 23.46

# 方法二：top
top - 16:48:42 up  4:12,  1 user,  load average: 25.25, 23.14, 23.37

# 方法三：cat /proc/loadavg
$ cat /proc/loadavg 
25.72 23.19 23.35 42/3411 43603
```

### 1.2 简单分析

- 如果平均值为 0.0，意味着系统处于空闲状态；
- 当CPU工作量饱和的时候，平均负荷为1。
- "load average"的值越低，比如等于0.2或0.3，就说明电脑的工作量越小，系统负荷比较轻。
- 如果 1min 平均值高于 5min 或 15min 平均值，则负载正在增加
- 如果 1min 平均值低于 5min 或 15min 平均值，则负载正在减少
- 如果它们高于系统 CPU 的数量，那么系统很可能会遇到性能问题（视情况而定）

> 1min、5min、15min 作为一个三元组，可以通过这三个值来判断系统中负载是正在增加还是减少。同时，它们也可以应用于其他的场景，例如作为云计算中实例自动扩缩容的规则。



## 2. 一个类比

判断系统负荷是否过重，必须理解load average的真正含义。

首先，假设最简单的情况，你的电脑只有一个CPU，所有的运算都必须由这个CPU来完成。

那么，我们不妨把这个CPU想象成一座大桥，桥上只有一根车道，所有车辆都必须从这根车道上通过。（很显然，这座桥只能单向通行。）

- 系统负荷为0，意味着大桥上一辆车也没有。

  ![image-20230510101406905](https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20230510101406905.png)

- 系统负荷为0.5，意味着大桥一半的路段有车。

  ![image-20230510101428274](https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20230510101428274.png)

- 系统负荷为1.0，意味着大桥的所有路段都有车，也就是说大桥已经"满"了。但是必须注意的是，直到此时大桥还是能顺畅通行的。

  ![image-20230510101453298](https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20230510101453298.png)

- 系统负荷为1.7，意味着车辆太多了，大桥已经被占满了（100%），后面等着上桥的车辆为桥面车辆的70%。以此类推，系统负荷2.0，意味着等待上桥的车辆与桥面的车辆一样多；系统负荷3.0，意味着等待上桥的车辆是桥面车辆的2倍。总之，当系统负荷大于1，后面的车辆就必须等待了；系统负荷越大，过桥就必须等得越久。

  ![image-20230510101526551](https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20230510101526551.png)



CPU的系统负荷，基本上等同于上面的类比。大桥的通行能力，就是CPU的最大工作量；桥梁上的车辆，就是一个个等待CPU处理的进程（process）。

如果CPU每分钟最多处理100个进程，那么系统负荷0.2，意味着CPU在这1分钟里只处理20个进程；系统负荷1.0，意味着CPU在这1分钟里正好处理100个进程；系统负荷1.7，意味着除了CPU正在处理的100个进程以外，还有70个进程正排队等着CPU处理。

为了电脑顺畅运行，系统负荷最好不要超过1.0，这样就没有进程需要等待了，所有进程都能第一时间得到处理。很显然，1.0是一个关键值，超过这个值，系统就不在最佳状态了，你要动手干预了。

## 3. **系统负荷的经验法则**

1.0是系统负荷的理想值吗？

不一定，系统管理员往往会留一点余地，当这个值达到0.7，就应当引起注意了。经验法则是这样的：

当系统负荷持续大于0.7，你必须开始调查了，问题出在哪里，防止情况恶化。

当系统负荷持续大于1.0，你必须动手寻找解决办法，把这个值降下来。

当系统负荷达到5.0，就表明你的系统有很严重的问题，长时间没有响应，或者接近死机了。你不应该让系统达到这个值。

## 4. **多处理器**

上面，我们假设你的电脑只有1个CPU。如果你的电脑装了2个CPU，会发生什么情况呢？

2个CPU，意味着电脑的处理能力翻了一倍，能够同时处理的进程数量也翻了一倍。

还是用大桥来类比，两个CPU就意味着大桥有两根车道了，通车能力翻倍了。

![image-20230510101736793](https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20230510101736793.png)

所以，2个CPU表明系统负荷可以达到2.0，此时每个CPU都达到100%的工作量。推广开来，n个CPU的电脑，可接受的系统负荷最大为n.0。

## 参考文章

[理解Linux系统负荷](https://www.ruanyifeng.com/blog/2011/07/linux_load_average_explained.html)

[Linux Load Averages：什么是平均负载？](https://zhuanlan.zhihu.com/p/75975041)
